# 设备广告ID功能

## 概述

该功能在应用首页简洁地显示设备的广告ID，支持iOS的IDFA和Android的GAID。采用分行布局，标题单独显示（iOS显示"IDFA:"，Android显示"GAID:"），设备ID完整显示在下方，并提供独立的复制按钮。特别针对iOS进行了权限处理优化，支持重新请求权限功能。

## 功能特性

- ✅ **分行布局**: 标题单独显示，避免内容被截断
- ✅ **平台识别**: iOS显示"IDFA:"，Android显示"GAID:"
- ✅ **完整显示**: 设备ID完整显示，支持文本选择
- ✅ **独立复制按钮**: 美观的复制按钮，适配主题色彩
- ✅ **智能权限管理**: iOS自动检测权限状态，避免不必要的权限弹窗
- ✅ **重新授权功能**: 用户拒绝权限后可点击按钮重新请求
- ✅ **iOS IDFA获取**: 使用App Tracking Transparency框架获取IDFA
- ✅ **Android GAID获取**: 使用Google Play Services获取广告ID
- ✅ **权限处理**: 自动请求并处理用户权限授权
- ✅ **错误处理**: 完善的错误状态显示和处理
- ✅ **加载状态**: 友好的加载状态指示器
- ✅ **隐藏导航**: 底部导航栏已隐藏，专注于主要功能
- ✅ **跨平台支持**: 支持iOS、Android和Web（Web显示不可用提示）

## 实现文件

### 1. `hooks/useDeviceId.ts`
自定义Hook，负责：
- 获取设备广告ID
- 处理平台差异
- 管理加载状态和错误状态
- iOS权限状态检测和请求
- 提供重新请求权限的方法

### 2. `app/(tabs)/index.tsx`  
首页组件，集成了设备ID显示功能：
- 使用`useDeviceId` Hook
- 简洁的居中显示设计
- 显示不同状态的UI（加载、成功、错误）
- 支持设备ID文本选择和复制
- 集成expo-clipboard实现一键复制

## 依赖包

- `expo-tracking-transparency`: 用于iOS广告跟踪权限和获取广告ID
- `expo-application`: 应用信息获取
- `expo-clipboard`: 用于复制设备ID到剪贴板
- `@expo/vector-icons`: 用于显示剪贴板图标

## 权限要求

### iOS
- 需要用户授权"允许App请求跟踪"权限
- 如果已授权，直接获取IDFA无需再次弹窗
- 如果用户拒绝，显示授权按钮允许重新请求
- 首次启动时会自动请求权限

### Android  
- 需要Google Play Services
- 自动获取GAID，无需额外权限弹窗

### Web
- 不支持广告ID获取，显示不可用提示

## 使用方法

启动应用后，首页会自动显示：

1. **加载状态**: "正在获取设备ID..." + 大型加载指示器
2. **成功状态**: 
   - 标题行："IDFA:"（iOS）或"GAID:"（Android）
   - 设备ID：完整的广告ID字符串
   - 复制按钮：带主题色彩的独立按钮
3. **iOS权限拒绝状态**: 
   - 显示"IDFA:"标题
   - 显示权限说明文本
   - 显示"授权获取广告ID"按钮
4. **错误状态**: 显示具体的错误原因，iOS拒绝权限时显示"重新授权"按钮
5. **复制功能**: 点击复制按钮后显示相应的成功提示
6. **权限请求**: 点击授权按钮后显示"请求权限中..."加载状态

## 注意事项

1. **iOS 14.5+**: 需要用户明确授权广告跟踪权限，应用会自动检测权限状态
2. **权限管理**: iOS上如果用户拒绝权限，可通过按钮重新请求
3. **Android**: 需要设备安装Google Play Services
4. **模拟器**: 可能返回测试ID扰00000000的占位符ID
5. **隐私**: 广告ID可以被用户在设备设置中重置或禁用

## 测试建议

- 在真实设备上测试以获得真实的广告ID
- 测试iOS用户拒绝权限后的重新授权流程
- 测试iOS已授权用户的直接获取功能
- 验证不同平台的行为一致性
- 测试权限状态在应用重启后的持久性
