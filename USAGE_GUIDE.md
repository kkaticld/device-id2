# 设备广告ID应用使用指南

## 📱 应用功能

这个应用的主要功能是获取并显示设备的广告ID：
- **iOS**: 显示 IDFA (Identifier for Advertisers)
- **Android**: 显示 GAID (Google Advertising ID)

## 🚀 快速开始

```bash
# 启动应用
npx expo start

# 在iOS模拟器中测试（仅用于UI测试）
npx expo start --ios

# 在Android模拟器中测试
npx expo start --android
```

## ⚠️ 重要说明

### iOS注意事项

1. **模拟器限制**: 
   - iOS模拟器**无法**获取真实的广告ID
   - 即使权限授权成功，模拟器也会返回null
   - 应用会自动检测模拟器并显示相应提示

2. **真机测试必需**:
   - 要获取真实的IDFA，**必须**在真实的iOS设备上测试
   - 使用Expo Go应用扫描二维码在真机上运行

3. **权限处理流程**:
   - 首次启动会自动请求"允许App请求跟踪"权限
   - 如果用户拒绝，会显示"授权获取广告ID"按钮
   - 点击按钮可以重新触发权限请求弹窗
   - 用户授权后立即获取并显示IDFA

### Android注意事项

1. **自动获取**: Android不需要用户明确授权，会自动获取GAID
2. **依赖要求**: 需要设备安装Google Play Services
3. **用户控制**: 用户可以在设备设置中禁用或重置GAID

## 🎯 UI布局说明

应用采用极简设计：

```
┌─────────────────────┐
│                     │
│      IDFA: 或       │  ← 根据平台显示标题
│      GAID:          │
│                     │
│  xxxxxxxx-xxxx-     │  ← 完整设备ID显示
│  xxxx-xxxx-         │    （支持长按选择）
│  xxxxxxxxxxxx       │
│                     │
│    ┌─────────┐      │  ← 复制按钮
│    │   复制   │      │
│    └─────────┘      │
│                     │
└─────────────────────┘
```

## 📋 功能特性

- ✅ **平台识别**: 自动显示对应的ID类型（IDFA/GAID）
- ✅ **权限智能处理**: 自动检测和请求必要权限
- ✅ **一键复制**: 点击复制按钮将ID复制到剪贴板
- ✅ **模拟器检测**: 自动识别模拟器并提供真机测试提示
- ✅ **错误处理**: 详细的错误信息和解决建议
- ✅ **重新授权**: iOS用户可以重新请求权限

## 🔧 开发调试

应用包含详细的控制台日志，有助于调试：

```bash
# 查看Metro bundler日志
npx expo start

# 日志示例：
# [DeviceID] 初始化权限检查, 平台: ios
# [DeviceID] TrackingTransparency API 可用性: true
# [DeviceID] 当前权限状态: {...}
```

## 🛠️ 故障排除

### iOS问题

**Q: 显示"iOS模拟器不支持获取真实的广告ID"**
- A: 这是正常的，请在真实的iOS设备上测试

**Q: 权限授权成功但仍然获取失败**
- A: 检查是否在真机上运行，或者用户是否在设置中禁用了广告跟踪

**Q: 无法重新请求权限**
- A: 如果用户多次拒绝，系统可能不再显示权限弹窗，需要在设置中手动开启

### Android问题

**Q: 获取到00000000格式的ID**
- A: 用户可能在设置中禁用了广告ID，或设备不支持

**Q: 提示需要Google Play Services**
- A: 确保设备安装了Google Play Services

## 📊 测试建议

1. **iOS真机测试**: 
   - 在iPhone/iPad上使用Expo Go测试
   - 测试权限拒绝和重新授权流程

2. **Android测试**:
   - 在Android设备或模拟器上测试
   - 验证GAID获取功能

3. **权限场景测试**:
   - 首次启动权限请求
   - 权限拒绝后的重新授权
   - 权限授权后的直接获取

## 🔐 隐私说明

- 广告ID用于广告投放和分析，不包含个人身份信息
- 用户可以随时在设备设置中重置或禁用广告ID
- 应用仅显示ID，不存储或上传任何数据
